# 17. 리액티브 프로그래밍

### 리액티브 프로그래밍 패러다임의 중요성이 증가하는 이유

- 빅데이터
    - 보통 빅데이터는 페타바이트 단위로 구성되며 매일 증가한다.
- 다양한 환경
    - 모바일 디바이스에서 수천 개의 멀티 코어 프로세서로 실행되는 클라우드 기반 클러스터에 이르기까지 다양한 환경에 애플리케이션이 배포됨.
- 사용 패턴
    - 사용자는 1년 내내 항상 서비스를 이용할 수 있으며, 밀리초 단위의 응답 시간을 기대함.

### 리액티브 프로그래밍이란?

- 다양한 시스템과 소스에서 들어오는 데이터 항목 스트림을 비동기적으로 처리하고 합쳐서 이러한 문제를 해결
- 발생한 데이터 항목을 바로 처리함으로써 사용자에게 높은 응답성을 제공.
- 고장, 정전 같은 상태에 대처할 뿐 아니라, 다양한 네트워크 상태에서 메시지를 교환하고 전달할 수 있으며 무거운 작업을 하고 있는 상황에서도 가용성을 제공.

### 리액티브 매니패스토(reactive manifesto)

- 반응성
    - 시스템은 가능한한 적정 시간안에 반응한다.
        - 리액티브 시스템은 빠를 뿐 아니라 더 중요한 특징으로 일정하고 예상할 수 있는 반응 시간을 제공한다.

- 회복성
    - 장애 시에도 시스템의 반응성은 유지된다.
        - 장애가 발생해도 시스템은 반응해야 한다. 컴포넌트 실행 복제, 여러 컴포넌트의 시간과 공간 분리, 각 컴포넌트가 비동기적으로 작업을 다른 컴포넌티에 위임하는 등 리액티브 매니페스토는 회복성을 달성할
          수 있는 다양한 기법 제공

- 탄력성
    - 다양한 작업 부하에도 반응성이 유지된다.
        - 무서운 작업 부하가 발생하면 자동으로 관련 컴포넌트에 할당 된 자원 수를 늘린다.

- 메시지 주도
    - 컴포넌트 간의 약한 결합, 고립, 위치 투명성이 유지되도록 시스템은 비동기 메시지 전달에 의존.
        - 회복성과 탄력성을 지원하려면 약한 결합, 고립, 위치 투명성 등을 지원할 수 있도록 시스템을 구성하는 컴포넌트의 경계를 명확하게 정의해야 함.
        - 비동기 메시지를 전달해 컴포넌트 끼리의 통신이 이루어진다. 이 덕분에 회복성(장애를 메시지로 처리)과 탄력성(주고 받은 메시지의 수를 감시하고 메시지의 양에 따라 리소스 할당)을 얻을 수 있다.

### 애플리케이션 수준의 리액티브

- 비동기로 작업을 수행
    - 스레드 보다 가벼울 뿐 아니라 개발자에게 큰 이득을 제공. 개발자 입장에서는 이들 기술을 이용함으로써 동시, 비동기 애플리케이션 구현의 추상 수준을 높일 수 있으므로 동기 블록, 경쟁 조건, 데드락 같은
      저 수준의 멀티쓰레드 문제를 직접 처리할 필요가 없어지면서 비즈니스 요구사항을 구현하는데 더 집중할 수 있다.
    - RxJava, Akka 같은 리액티브 프레임워크는 별도로 지정된 스레드 풀에서 블록 동작을 실행시킴. 메인 풀의 모든 스레드는 방해받지 않고 실행되므로 모든 CPU 코어가 가장 최적의 상황에서 동작할 수
      있다.

### 시스템 수준의 리액티브

- 여러 애플리케이션이 한 개의 일관적인, 회복할 수 있는 플랫폼을 구헝할 수 있게 헤줄 뿐 아니라 이들 애플리케이션 중 하나가 실패해도 전체 시스템은 계속 운영될 수 있도록 도와주는 소프트웨어 아키텍처.
    - 리액티브 애플리케이션은 비교적 짧은 시간 동안만 유지되는 데이터 스트림에 기반한 연산을 수행하며 보통 이벤트 주도로 분류된다.
    - 반면 리액티브 시스템은 애플리케이션을 조립하고 상호소통을 조절한다. 리액티브 시스템의 주요 속성으로 메시지 주도를 꼽을 수 있다.

- 메시지는 정의된 목적지 하나를 향하는 반면, 이벤트는 관련 이벤트를 관찰하도록 등록된 컴포넌트가 수신한다는 점이 다름.
    - 리액티브 시스템에서는 수신자와 발신자가 각각 수신 메시지, 발신 메시지와 결합하지 않도록 이들 메시지를 비동기로 처리해야 한다.
    - 각 컴포넌트를 완전히 고립하려면 이들이 결합하지 않도록 해야 하며, 그래야만 시스템이 장애(회복성)와 높은 부하(탄력성)에도 반응성을 유지할 수 있다.
    - 좀 더 정확히 말해 리액티브 아키텍처에서는 컴포넌트에 발생한 장애를 고립시킴으로써 문제가 주변의 다른 컴포넌트로 전파되면서 전체 시스템 장애로 이어지는 것을 막음으로서 회복성을 제공.
- 회복성은 결합 허용 능력과 같은 의미를 지님.
    - 시스템에 장애가 발생했을때 서서히 성능이 저하되는 것이 아니라, 문제를 격리함으로써 장애에서 완전히 복구되어 건강한 상태로 시스템이 돌아옴. => 에러 전파 방지

- 위치 투명성은 리액티브 시스템의 모든 컴포넌트가 수신자의 위치에 상관없이 다른 모든 서비스와 통신할 수 있음을 의미.
    - 위치 투명성 덕분에 시스템을 복제할 수 있으며, 현재 작업 부하에 따라 애플리케이션을 확장할 수 있음.

### 리액티브 프로그래밍

- 리액티브 스트림을 사용하는 프로그래밍
- 리액티브 스트림은 잠재적으로 무한의 비동기 데이터를 순서대로 그리고 블록하지 않은 역압력을 전재해 처리하는 표준 기술.
    - 역압력: 발행-구독 프로토콜에서 이벤트 스트림의 구독자가 발행자가 이벤트를 제공하는 속도보다 느린 속도로 이벤트를 소비하면서 문제가 발생하지 않도록 보장하는 장치 => 부하가 발생한 컴포넌트가 완전 불능이
      되거나 예기치 않은 방식으로 이벤트를 잃어버리는 등의 문제가 발생하지 않음.

    - 실제 비동기 작업이 실행되는 동안 시스템에는 암묵적으로 블록 API로 인해 역압력이 제공되는 것

### Flow 클래스

- 자바9, java.util.concurrent.FLow

- Publisher
- Subscriber
- Subscription
- Processor

- Publisher가 항목을 발행하면 Subscriber가 한 개씩 또는 한 번에 여러 항목을 소비하는데 Subscription이 이 과정을 관리.

### 정리

- 리액티브 소프트웨어가 지녀야 할 네 가지 관련 특징(반응성, 회복성, 탄력성, 메시지 주도)을 서술하는 리액티브 매니페스토가 리액티브 프로그래밍 사상을 공식화한다.
- 리액티브 애플리케이션은 리액티브 스트림이 전달하는 한 개 이상의 이벤트를 비동기로 처리함을 기본으로 전제한다.
- 리액티브 스트림은 비동기적으로 처리되므로 역압력 기법이 기본적으로 탑재되어 있다. 역압력은 발행자가 구독자보다 빠른 속도로 아이템을 발행하므로 발생하는 문제를 방지.
- 자바9 플로 API는 Publisher, Subscriber, Subscription, Processor 네 개의 핵심 인터페이스를 정의한다.
- 대부분의 상황에서는 이들 인터페이스를 직접 구현할 필요가 없으며 실제 이들 인터페이스는 리액티브 패러다임을 구현하는 다양한 라이브러리의 공용어 역할을 한다.